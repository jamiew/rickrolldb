<%
require 'rss/maker'

## generate RSS
content = RSS::Maker.make("2.0") { |m|
  m.channel.title = "RickrollDB updates"
  m.channel.link = "http://www.rickrolldb.com/rss"
  m.channel.description = "Latest submissions to the Rickroll Database, the #1 weapon in the war on 'rolls"
  # m.items.do_sort = true # sort items by date

  @entries.each { |entry|
    i = m.items.new_item
    i.title = entry.url
    i.link = entry.url
    last_flag = entry.flags.last
    i.description = "
<![CDATA[	
    contributor #{last_flag.ip} <br />
    action: #{last_flag.name} <br />
    #{entry.confirmations.length} yeas, #{entry.disputes.length} nays <br />
    blacklisted?: #{entry.confirmed?} <br />

    <img src=\"#{entry.thumbnail}\" /> <br /> ]]>
"
    #i.date = Time.now # they don't give us a time, bastards
    i.date = last_flag.timestamp
  }
}
%>
<%= content %>
